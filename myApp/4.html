<html>
    <body>
        <image id="image1"></image>
    </body>
    <script>
        var log = console.log;
        [1,2,3].forEach(x=> log(x));

        var mapped = [1,2,3].map(x => x+1);
        log(mapped);

        var filtered = [1,2,3].filter(x => x > 1);
        log(filtered);

        var iterator1 = [1,2,3][Symbol.iterator]();
        log(iterator1.next());

        var iterator = function(context){   // this is the iterator pattern
            return context[Symbol.iterator]();
        };

        var iterator2 = iterator([2,3]);
        log(iterator2.next());

        var handler = (e) => log(e);
        document.addEventListener("mousemove", handler);    // subscribe - this is the observer pattern (not carefully thought)
        setTimeout(() => {
            document.removeEventListener("mousemove", handler); // unsubscribe
        }, 500);  

        //convert Events to Observables
        Observable = {};
        Observable.fromEvent = function(dom, eventName){
            // returning Observable object
            return {
                forEach: function(observer){
                    var handler = (e) => observer.onNext(e);
                    dom.addEventListener(eventName, handler);

                    // returning subscription object
                    return {
                        dispose: function(){
                            dom.removeEventListener(eventName, handler);
                        }
                    };
                }
            };
        };

        var getElementDrags = elmt => {
            elmt.mouseDowns = Observable.fromEvent(elmt, "mousedown");
            elmt.mouseUps = Observable.fromEvent(elmt, "mouseup");
            elmt.mouseMoves = Observable.fromEvent(elmt, "mousemove");

            return elmt.mouseDowns.map(mouseDown => elmt.mouseMoves);
        };
        var image = document.getElementById("image1");
        //getElementDrags(image).forEach(pos => image.position = pos);

        var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"];

        names.forEach(function(name) {
            console.log(name);
        });

        ///////////// 3
        var projection = function() {
            var newReleases = [
                {
                    "id": 70111470,
                    "title": "Die Hard",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 654356453,
                    "title": "Bad Boys",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                },
                {
                    "id": 65432445,
                    "title": "The Chamber",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 675465,
                    "title": "Fracture",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                }
            ],
            videoAndTitlePairs = [];

            // ------------ INSERT CODE HERE! -----------------------------------
            // Use forEach function to accumulate {id, title} pairs from each video.
            // Put the results into the videoAndTitlePairs array using the Array's
            // push() method. Example: videoAndTitlePairs.push(newItem);
            // ------------ INSERT CODE HERE! -----------------------------------
            newReleases.forEach(video => videoAndTitlePairs.push({id: video.id, title: video.title}));

            return videoAndTitlePairs;
        }
		log(projection());

        // 4
        Array.prototype.map = function(projectionFunction) {
            var results = [];
            this.forEach(function(itemInArray) {

                // ------------ INSERT CODE HERE! ----------------------------
                // Apply the projectionFunction to each item in the array and add
                // each result to the results array.
                // Note: you can add items to an array with the push() method.
                // ------------ INSERT CODE HERE! ----------------------------
                results.push(projectionFunction(itemInArray));
            });

            return results;
        };

        log(JSON.stringify([1,2,3].map(function(x) { return x + 1; })) === '[2,3,4]');
        
        // 5
        var projection2 = function() {
            var newReleases = [
                {
                    "id": 70111470,
                    "title": "Die Hard",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 654356453,
                    "title": "Bad Boys",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                },
                {
                    "id": 65432445,
                    "title": "The Chamber",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 675465,
                    "title": "Fracture",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                }
            ];

            // ------------ INSERT CODE HERE! -----------------------------------
            // Use map function to accumulate {id, title} pairs from each video.
            return newReleases.map(video => ({ id: video.id, title: video.title })); // finish this expression!
            // ------------ INSERT CODE HERE! -----------------------------------
        }

    log(projection2());

        // 6
    var filtering = function() {
        var newReleases = [
            {
                "id": 70111470,
                "title": "Die Hard",
                "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 654356453,
                "title": "Bad Boys",
                "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            },
            {
                "id": 65432445,
                "title": "The Chamber",
                "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 675465,
                "title": "Fracture",
                "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            }
        ],
        videos = newReleases.filter(video => video.rating == 5);

        // ------------ INSERT CODE HERE! -----------------------------------
        // Use forEach function to accumulate every video with a rating of 5.0
        // ------------ INSERT CODE HERE! -----------------------------------
            
        return videos;
    }

    log(filtering());

    // 7
    Array.prototype.filter = function(predicateFunction) {
        var results = [];
        this.forEach(function(itemInArray) {
            // ------------ INSERT CODE HERE! ----------------------------
            // Apply the predicateFunction to each item in the array.
            // If the result is truthy, add the item to the results array.
            // Note: remember you can add items to the array using the array's
            // push() method.
            // ------------ INSERT CODE HERE! ----------------------------
            var isTrue = predicateFunction(itemInArray);
            if(isTrue){
                results.push(itemInArray);
            }
        });

        return results;
    };

    log(JSON.stringify([1,2,3].filter(function(x) { return x > 2})) === "[3]");

    // 8
    var chaining = function() {
        var newReleases = [
            {
                "id": 70111470,
                "title": "Die Hard",
                "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 654356453,
                "title": "Bad Boys",
                "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            },
            {
                "id": 65432445,
                "title": "The Chamber",
                "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 675465,
                "title": "Fracture",
                "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            }
        ];

        // ------------ INSERT CODE HERE! -----------------------------------
        // Chain the filter and map functions to select the id of all videos
        // with a rating of 5.0.
        return newReleases
            .filter(video => video.rating === 5)
            .map(video => video.id) // Complete this expression
        // ------------ INSERT CODE HERE! -----------------------------------
    }

    log(chaining());

    // 9
    var flatten = function() {
            var movieLists = [
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "Dramas",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ],
            allVideoIdsInMovieLists = [];

            // ------------   INSERT CODE HERE!  -----------------------------------
            // Use two nested forEach loops to flatten the movieLists into a list of
            // video ids.
            // ------------   INSERT CODE HERE!  -----------------------------------
            movieLists.forEach(movieList => {
                movieList.videos.forEach(video => {
                    allVideoIdsInMovieLists.push(video.id);
                });
            });

            return allVideoIdsInMovieLists;

        }
		
        log(flatten());

        // 10.
        Array.prototype.concatAll = function() {
            var results = [];
            this.forEach(function(subArray) {
                // ------------ INSERT CODE HERE! ----------------------------
                // Add all the items in each subArray to the results array.
                // ------------ INSERT CODE HERE! ----------------------------
                subArray.forEach((subArrayElement) => {
                    results.push(subArrayElement);
                });
            });

        return results;
    };

    log(JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]");
    try{
        [1,2,3].concatAll(); // throws an error because this is a one-dimensional array
    }
    catch(err){
        log(err);
    }

    // 11.
    var mapAndConcatAll =function() {
        var movieLists = [
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "Dramas",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];

        // ------------   INSERT CODE HERE!  -----------------------------------
        // Use map and concatAll to flatten the movieLists in a list of video ids.
        // ------------   INSERT CODE HERE!  -----------------------------------

        return movieLists
            .map(ml => ml.videos.map(video => video.id))
            .concatAll(); // Complete this expression!
    }

    log(11, mapAndConcatAll());

    // 12.
    var idTitleAndOneBoxArt = function() {
        var movieLists = [
                {
                    name: "Instant Queue",
                    videos : [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];


        // Use one or more map, concatAll, and filter calls to create an array with the following items
        // [
        //	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
        //	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
        //	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
        //	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        // return movieLists
        //     .map(ml => ml.videos)
        //     .concatAll()
        //     .map(video => ({ 
        //         id: video.id, 
        //         title: video.title, 
        //         boxart: 
        //             video.boxarts
        //                 .filter(ba => ba.height === 200 && ba.width === 150)
        //                 .map(boxart => boxart.url)
        //     }));
        return movieLists
            .map(ml => 
                ml.videos.map(video => 
                    video.boxarts
                        .filter(ba => ba.height === 200 && ba.width === 150)
                        .map(boxart => ({
                            id: video.id,
                            title: video.title,
                            boxart: boxart.url
                        }))))
            .concatAll()
            .concatAll();
             // Complete this expression!
    }

    log(12, idTitleAndOneBoxArt());
    </script>
</html>