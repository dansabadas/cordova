<html>
    <head>
    </head>
    <body>
        <image id="image1" src="https://www.gstatic.com/webp/gallery3/1.png"></image>
        <button id="button1">Click me!</button>
        <input id="textbox"></input>
        <textarea id="results"></textarea>
    </body>
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.5.10/Rx.js"></script>
    <!-- <script src="https://npmcdn.com/@reactivex/rxjs@5.0.0-beta.3/dist/global/Rx.umd.js"></script> -->

    <!-- <script src="https://raw.githubusercontent.com/Reactive-Extensions/RxJS/master/dist/rx.all.js"></script> -->
    <!-- <script src="https://unpkg.com/@reactivex/rxjs@5.5.10/dist/global/Rx.js"></script> -->
    <script>
        var log = console.log;
        [1,2,3].forEach(x=> log(x));

        var mapped = [1,2,3].map(x => x+1);
        log(mapped);

        var filtered = [1,2,3].filter(x => x > 1);
        log(filtered);

        var iterator1 = [1,2,3][Symbol.iterator]();
        log(iterator1.next());

        var iterator = function(context){   // this is the iterator pattern
            return context[Symbol.iterator]();
        };

        var iterator2 = iterator([2,3]);
        log(iterator2.next());

        var handler = (e) => log(e);
        document.addEventListener("mousemove", handler);    // subscribe - this is the observer pattern (not carefully thought)
        setTimeout(() => {
            document.removeEventListener("mousemove", handler); // unsubscribe
        }, 500);  

        //convert Events to Observables
        // Observable1 = {};
        // Observable1.fromEvent = function(dom, eventName){
        //     // returning Observable object
        //     return {
        //         forEach: function(observer){
        //             var handler = (e) => observer.onNext(e);
        //             dom.addEventListener(eventName, handler);

        //             // returning subscription object
        //             return {
        //                 dispose: function(){
        //                     dom.removeEventListener(eventName, handler);
        //                 }
        //             };
        //         }
        //     };
        // };

        var getElementDrags = elmt => {
            elmt.mouseDowns = Observable1.fromEvent(elmt, "mousedown");
            elmt.mouseUps = Observable1.fromEvent(elmt, "mouseup");
            elmt.mouseMoves = Observable1.fromEvent(elmt, "mousemove");

            return elmt.mouseDowns.map(mouseDown => elmt.mouseMoves);
        };
        var image = document.getElementById("image1");
        //getElementDrags(image).forEach(pos => image.position = pos);

        var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"];

        names.forEach(function(name) {
            console.log(name);
        });

        //http://reactivex.io/learnrx/
        ///////////// 3 also show polifill https://developer.mozilla.org/ro/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach added in ES5 2009
        var projection = function() {
            var newReleases = [
                {
                    "id": 70111470,
                    "title": "Die Hard",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 654356453,
                    "title": "Bad Boys",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                },
                {
                    "id": 65432445,
                    "title": "The Chamber",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 675465,
                    "title": "Fracture",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                }
            ],
            videoAndTitlePairs = [];

            // ------------ INSERT CODE HERE! -----------------------------------
            // Use forEach function to accumulate {id, title} pairs from each video.
            // Put the results into the videoAndTitlePairs array using the Array's
            // push() method. Example: videoAndTitlePairs.push(newItem);
            // ------------ INSERT CODE HERE! -----------------------------------
            newReleases.forEach(video => videoAndTitlePairs.push({id: video.id, title: video.title}));

            return videoAndTitlePairs;
        }
		log(projection());

        // 4 we will override the map!! stupid but we do it anyway!
        Array.prototype.map = function(projectionFunction) {
            var results = [];
            this.forEach(function(itemInArray) {

                // ------------ INSERT CODE HERE! ----------------------------
                // Apply the projectionFunction to each item in the array and add
                // each result to the results array.
                // Note: you can add items to an array with the push() method.
                // ------------ INSERT CODE HERE! ----------------------------
                results.push(projectionFunction(itemInArray));
            });

            return results;
        };

        log(JSON.stringify([1,2,3].map(function(x) { return x + 1; })) === '[2,3,4]');
        
        // 5 => much simpler as compared with 3. don't forget the ( parenthesis!!)
        var projection2 = function() {
            var newReleases = [
                {
                    "id": 70111470,
                    "title": "Die Hard",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 654356453,
                    "title": "Bad Boys",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                },
                {
                    "id": 65432445,
                    "title": "The Chamber",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 675465,
                    "title": "Fracture",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                }
            ];

            // ------------ INSERT CODE HERE! -----------------------------------
            // Use map function to accumulate {id, title} pairs from each video.
            return newReleases.map(video => ({ id: video.id, title: video.title })); // finish this expression!
            // ------------ INSERT CODE HERE! -----------------------------------
        }

    log(projection2());

        // 6
    var filtering = function() {
      var newReleases = [
        {
          "id": 70111470,
          "title": "Die Hard",
          "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
          "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
          "rating": 4.0,
          "bookmark": []
        },
        {
          "id": 654356453,
          "title": "Bad Boys",
          "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
          "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
          "rating": 5.0,
          "bookmark": [{ id: 432534, time: 65876586 }]
        },
        {
          "id": 65432445,
          "title": "The Chamber",
          "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
          "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
          "rating": 4.0,
          "bookmark": []
        },
        {
          "id": 675465,
          "title": "Fracture",
          "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
          "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
          "rating": 5.0,
          "bookmark": [{ id: 432534, time: 65876586 }]
        }
      ],
        videos = [];
        //videos = newReleases.filter(video => video.rating == 5); // much more elegant
      newReleases.forEach(video => {
        if (video.rating === 5) {
          videos.push(video);
        }
      });
        // ------------ INSERT CODE HERE! -----------------------------------
        // Use forEach function to accumulate every video with a rating of 5.0
        // ------------ INSERT CODE HERE! -----------------------------------
            
        return videos;
    }

    log(filtering());

    // 7
    Array.prototype.filter = function(predicateFunction) {
        var results = [];
        this.forEach(function(itemInArray) {
            // ------------ INSERT CODE HERE! ----------------------------
            // Apply the predicateFunction to each item in the array.
            // If the result is truthy, add the item to the results array.
            // Note: remember you can add items to the array using the array's
            // push() method.
            // ------------ INSERT CODE HERE! ----------------------------
            var isTrue = predicateFunction(itemInArray);
            if(isTrue){
                results.push(itemInArray);
            }
        });

        return results;
    };

    log(JSON.stringify([1,2,3].filter(function(x) { return x > 2})) === "[3]");

    // 8
    var chaining = function() {
        var newReleases = [
            {
                "id": 70111470,
                "title": "Die Hard",
                "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 654356453,
                "title": "Bad Boys",
                "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            },
            {
                "id": 65432445,
                "title": "The Chamber",
                "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 675465,
                "title": "Fracture",
                "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            }
        ];

        // ------------ INSERT CODE HERE! -----------------------------------
        // Chain the filter and map functions to select the id of all videos
        // with a rating of 5.0.
        return newReleases
            .filter(video => video.rating === 5)
            .map(video => video.id) // Complete this expression
        // ------------ INSERT CODE HERE! -----------------------------------
    }

    log(chaining());

    // 9
    var flatten = function() {
            var movieLists = [
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "Dramas",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ],
            allVideoIdsInMovieLists = [];

            // ------------   INSERT CODE HERE!  -----------------------------------
            // Use two nested forEach loops to flatten the movieLists into a list of
            // video ids.
            // ------------   INSERT CODE HERE!  -----------------------------------
            movieLists.forEach(movieList => {
                movieList.videos.forEach(video => {
                    allVideoIdsInMovieLists.push(video.id);
                });
            });

            return allVideoIdsInMovieLists;

        }
		
        log(flatten());

        // 10. => we want to avoid the approach from 9. => create a concatAll! this does not exist anymore on ES5 array
      // show the try-catch below! we need multi-doimensional arr for concatAll
        Array.prototype.concatAll = function() {
            var results = [];
            this.forEach(function(subArray) {
                // ------------ INSERT CODE HERE! ----------------------------
                // Add all the items in each subArray to the results array.
                // ------------ INSERT CODE HERE! ----------------------------
                subArray.forEach((subArrayElement) => {
                    results.push(subArrayElement);
                });
            });

        return results;
    };

    log(JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]");
    try{
        [1,2,3].concatAll(); // throws an error because this is a one-dimensional array
    }
    catch(err){
        log(err);
    }

    // 11.
    var mapAndConcatAll =function() {
        var movieLists = [
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "Dramas",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];

        // ------------   INSERT CODE HERE!  -----------------------------------
        // Use map and concatAll to flatten the movieLists in a list of video ids.
        // ------------   INSERT CODE HERE!  -----------------------------------

        return movieLists
            .map(ml => ml.videos.map(video => video.id))
            .concatAll(); // Complete this expression!
    }

    log(11, mapAndConcatAll());

    // 12. the first big mental leap. show the commented example with [0] and demand to be completely async functional with 2 inner closures!
      // for this exercise we cannot use index like movieLists[0] movieLists[i] or any iteration
    var idTitleAndOneBoxArt = function() {
        var movieLists = [
                {
                    name: "Instant Queue",
                    videos : [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];


        // Use one or more map, concatAll, and filter calls to create an array with the following items
        // [
        //	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
        //	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
        //	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
        //	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        // return movieLists
        //     .map(ml => ml.videos)
        //     .concatAll()
        //     .map(video => ({ 
        //         id: video.id, 
        //         title: video.title, 
        //         boxart: 
        //             video.boxarts
        //                 .filter(ba => ba.height === 200 && ba.width === 150)
        //                 .map(boxart => boxart.url)
        //     }));
        return movieLists
            .map(ml => 
                ml.videos.map(video => 
                    video.boxarts
                        .filter(ba => ba.height === 200 && ba.width === 150)
                        .map(boxart => ({
                            id: video.id,
                            title: video.title,
                            boxart: boxart.url
                        }))))
            .concatAll()
            .concatAll();
             // Complete this expression!
    }

    log(12, idTitleAndOneBoxArt());

    // 13.
    Array.prototype.concatMap = function(projectionFunctionThatReturnsArray) {
	    return this
		    .map((item) => projectionFunctionThatReturnsArray(item))		
		    .concatAll();// apply the concatAll function to flatten the two-dimensional array
    };


	var spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ];
	// collect all the words for each number, in every language, in a single, flat list
	var allWords = [0,1,2].
		concatMap(function(index) {
			return spanishFrenchEnglishWords[index];
		});

	log(13, JSON.stringify(allWords) === '["cero","rien","zero","uno","un","one","dos","deux","two"]');

    // 14. You can think of this pattern as the functional version of a nested forEach!
    var concatMap = function() {
        var movieLists = [
                {
                    name: "Instant Queue",
                    videos : [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];


        // Use one or more concatMap, map, and filter calls to create an array with the following items
        // [
        //	 {"id": 675465, "title": "Fracture", "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
        //	 {"id": 65432445, "title": "The Chamber", "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
        //	 {"id": 654356453, "title": "Bad Boys", "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
        //	 {"id": 70111470, "title": "Die Hard", "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        return movieLists
                .concatMap(ml => 
                    ml.videos.concatMap(video => 
                        video.boxarts
                            .filter(ba => ba.height === 200 && ba.width === 150)
                            .map(boxart => ({
                                id: video.id,
                                title: video.title,
                                boxart: boxart.url
                            })))); // Complete this expression!
    };
	log(14, concatMap());

    [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }); //=== [6];
    [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }, 10); //=== [16];

    //15.
    var forEachFind = function() {
        var boxarts = [
                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
                { width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
            ],
            currentSize,
            maxSize = -1,
            largestBoxart;

        boxarts.forEach(function(boxart) {
            currentSize = boxart.width * boxart.height;
            if (currentSize > maxSize) {
                largestBoxart = boxart;
                maxSize = currentSize;
            }
        });

        return largestBoxart;
    }
    log(15, forEachFind());

    // 16.
    Array.prototype.reduce = function(combiner, initialValue) {
        var counter,
            accumulatedValue;

        // If the array is empty, do nothing
        if (this.length === 0) {
            return this;
        }

        // If the user didn't pass the initial value, use the first item as initial value.
        if (arguments.length === 1) {
            counter = 1;
            accumulatedValue = this[0];
        }
        else if (arguments.length === 2) {
            counter = 0;
            accumulatedValue = initialValue;
        }
        else {
            throw "Invalid arguments.";
        }

        // Loop through the array, feeding the current value and the result of
        // the previous computation back into the combiner function until
        // we've exhausted the entire array and are left with only one value.
        while(counter < this.length) {
            accumulatedValue = combiner(accumulatedValue, this[counter]);
            counter += 1;
        }

        return [accumulatedValue];
    };

    //17.

    var reduceTheLargestRating = function() {
        var ratings = [2,3,1,4,5];

        // You should return an array containing only the largest rating. Remember that reduce always
        // returns an array with one item.
        return ratings.
            reduce((x,y) => x - y > 0 ? x : y);   // Complete this expression
    };
	log(17, reduceTheLargestRating());

    // 18.
    var largestBoxartUrlWithMapReduce = function() {
        var boxarts = [
                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
                { width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
            ];

        // You should return an array containing only the URL of the largest box art. Remember that reduce always
        // returns an array with one item.
        return boxarts
            .reduce((x, y) => x.width * x.height > y.width * y.height ?  x : y)
            .map(x => x.url);   // Complete this expression
    };

    // 19.
    var accumulatedMap = function() {
        var videos = [
            {
                "id": 65432445,
                "title": "The Chamber"
            },
            {
                "id": 675465,
                "title": "Fracture"
            },
            {
                "id": 70111470,
                "title": "Die Hard"
            },
            {
                "id": 654356453,
                "title": "Bad Boys"
            }
        ];

        // Expecting this output...
        // [
        //	 {
        //		 "65432445": "The Chamber",
        //		 "675465": "Fracture",
        //		 "70111470": "Die Hard",
        //		 "654356453": "Bad Boys"
        //	 }
        // ]
        return videos.
            reduce(function(accumulatedMap, video) {
                var obj = {};

                // ----- INSERT CODE TO ADD THE VIDEO TITLE TO THE ----
                // ----- NEW MAP USING THE VIDEO ID AS THE KEY	 ----

                // Object.assign() takes all of the enumerable properties from
                // the object listed in its second argument (obj) and assigns them
                // to the object listed in its first argument (accumulatedMap).
                obj[video.id] = video.title;
                return Object.assign(accumulatedMap, obj);  // .assign is ES6 specific! use Object.create approach instead, if no ES6 support
            },
            // Use an empty map as the initial value instead of the first item in
            // the list.
            {});
    };
    log(19, accumulatedMap());

    // 20.
    var concatMapReduceSmallestBoxart = function() {
        var movieLists = [
            {
                name: "New Releases",
                videos: [
                    {
                        "id": 70111470,
                        "title": "Die Hard",
                        "boxarts": [
                            { width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                        "bookmark": []
                    },
                    {
                        "id": 654356453,
                        "title": "Bad Boys",
                        "boxarts": [
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                            { width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                        "bookmark": [{ id:432534, time:65876586 }]
                    }
                ]
            },
            {
                name: "Thrillers",
                videos: [
                    {
                        "id": 65432445,
                        "title": "The Chamber",
                        "boxarts": [
                            { width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                        "bookmark": []
                    },
                    {
                        "id": 675465,
                        "title": "Fracture",
                        "boxarts": [
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                            { width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
                            { width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                        "bookmark": [{ id:432534, time:65876586 }]
                    }
                ]
            }
        ];


        // Use one or more concatMap, map, and reduce calls to create an array with the following items (order doesn't matter)
        // [
        //	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
        //	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
        //	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" },
        //	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        return movieLists.
            concatMap(movieList =>
                movieList.videos
                    .concatMap(video => 
                        video.boxarts
                            .reduce((ba1, ba2) => ba1.width * ba1.height > ba2.width * ba2.height ?  ba2 : ba1)
                            .map(ba => ({id: video.id, title: video.title, boxart: ba.url}))
                    )
            );
    };
		log(20, concatMapReduceSmallestBoxart());

        // 21.
        var zip = function() {
            var videos = [
                    {
                        "id": 70111470,
                        "title": "Die Hard",
                        "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                        "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                    },
                    {
                        "id": 654356453,
                        "title": "Bad Boys",
                        "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                        "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                    },
                    {
                        "id": 65432445,
                        "title": "The Chamber",
                        "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                        "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                    },
                    {
                        "id": 675465,
                        "title": "Fracture",
                        "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                        "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                    }
                ],
                bookmarks = [
                    {id: 470, time: 23432},
                    {id: 453, time: 234324},
                    {id: 445, time: 987834}
                ],
            counter,
            videoIdAndBookmarkIdPairs = [];

            for(counter = 0; counter < Math.min(videos.length, bookmarks.length); counter++) {
                // Insert code here to create a {videoId, bookmarkId} pair and add it to the videoIdAndBookmarkIdPairs array.
                videoIdAndBookmarkIdPairs.push({
                    videoId: videos[counter].id,
                    bookmarkId: bookmarks[counter].id
                });
            }

            return videoIdAndBookmarkIdPairs;
        }

        log(21, zip());

        //22.
 
    Array.zip = function(left, right, combinerFunction) {
        var counter,
            results = [];

        for(counter = 0; counter < Math.min(left.length, right.length); counter++) {
            // Add code here to apply the combinerFunction to the left and right-hand items in the respective arrays
            results.push(combinerFunction(left[counter], right[counter]));
        }

        return results;
    };
	log(22, JSON.stringify(Array.zip([1,2,3],[4,5,6], function(left, right) { return left + right })) === '[5,7,9]')

var videosBookmarsCombineZip = function() {
	var videos = [
			{
				"id": 70111470,
				"title": "Die Hard",
				"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
				"rating": 4.0,
			},
			{
				"id": 654356453,
				"title": "Bad Boys",
				"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
				"rating": 5.0,
			},
			{
				"id": 65432445,
				"title": "The Chamber",
				"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
				"rating": 4.0,
			},
			{
				"id": 675465,
				"title": "Fracture",
				"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
				"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
				"rating": 5.0,
			}
		],
		bookmarks = [
			{id: 470, time: 23432},
			{id: 453, time: 234324},
			{id: 445, time: 987834}
		];

	return Array.
		zip(videos, bookmarks, 
            (video, bookmark) => ({
                videoId: video.id,
                bookmarkId: bookmark.id
            }));  //... finish this expression
};
    log(23, videosBookmarsCombineZip());

    var idTitleMiddleInterestingSmallesBoxart = function() {
	var movieLists = [
			{
				name: "New Releases",
				videos: [
					{
						"id": 70111470,
						"title": "Die Hard",
						"boxarts": [
							{ width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
							{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
						],
						"url": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"interestingMoments": [
							{ type: "End", time:213432 },
							{ type: "Start", time: 64534 },
							{ type: "Middle", time: 323133}
						]
					},
					{
						"id": 654356453,
						"title": "Bad Boys",
						"boxarts": [
							{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
							{ width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

						],
						"url": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"interestingMoments": [
							{ type: "End", time:54654754 },
							{ type: "Start", time: 43524243 },
							{ type: "Middle", time: 6575665}
						]
					}
				]
			},
			{
				name: "Instant Queue",
				videos: [
					{
						"id": 65432445,
						"title": "The Chamber",
						"boxarts": [
							{ width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
							{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
						],
						"url": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"interestingMoments": [
							{ type: "End", time:132423 },
							{ type: "Start", time: 54637425 },
							{ type: "Middle", time: 3452343}
						]
					},
					{
						"id": 675465,
						"title": "Fracture",
						"boxarts": [
							{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
							{ width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
							{ width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
						],
						"url": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"interestingMoments": [
							{ type: "End", time:45632456 },
							{ type: "Start", time: 234534 },
							{ type: "Middle", time: 3453434}
						]
					}
				]
			}
		];

	//------------ COMPLETE THIS EXPRESSION --------------
	return movieLists.
            concatMap(movieList =>
                movieList.videos
                    .concatMap(video => 
                        Array.zip(
                            video.boxarts
                                .reduce((ba1, ba2) => ba1.width * ba1.height > ba2.width * ba2.height ?  ba2 : ba1)
                                .map(ba => ({url: ba.url})),
                            video.interestingMoments
                                .filter(im => im.type === "Middle")
                                .map(im => ({id: video.id, title: video.title, time: im.time})),
                            (boxart, interestingMoment) => Object.assign(interestingMoment, boxart))
                    )
            );

}
		log(24, idTitleMiddleInterestingSmallesBoxart());

        // 25.
        var sqlJoin = function() {
            var lists = [
                    {
                        "id": 5434364,
                        "name": "New Releases"
                    },
                    {
                        "id": 65456475,
                        "name": "Thrillers"
                    }
                ],
                videos = [
                    {
                        "listId": 5434364,
                        "id": 65432445,
                        "title": "The Chamber"
                    },
                    {
                        "listId": 5434364,
                        "id": 675465,
                        "title": "Fracture"
                    },
                    {
                        "listId": 65456475,
                        "id": 70111470,
                        "title": "Die Hard"
                    },
                    {
                        "listId": 65456475,
                        "id": 654356453,
                        "title": "Bad Boys"
                    }
                ];

            return lists.map(list =>
                ({
                    name: list.name,
                    videos: videos
                        .filter(video => video.listId === list.id)
                        .map(video => ({ 
                            id: video.id,
                            title: video.title
                        }))
                })
            ); // complete this expression
        };
		log(25, sqlJoin());

        //26.
        var deeperTrees = function() {
	var lists = [
			{
				"id": 5434364,
				"name": "New Releases"
			},
			{
				"id": 65456475,
				name: "Thrillers"
			}
		],
		videos = [
			{
				"listId": 5434364,
				"id": 65432445,
				"title": "The Chamber"
			},
			{
				"listId": 5434364,
				"id": 675465,
				"title": "Fracture"
			},
			{
				"listId": 65456475,
				"id": 70111470,
				"title": "Die Hard"
			},
			{
				"listId": 65456475,
				"id": 654356453,
				"title": "Bad Boys"
			}
		],
		boxarts = [
			{ videoId: 65432445, width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
			{ videoId: 65432445, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" },
			{ videoId: 675465, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
			{ videoId: 675465, width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
			{ videoId: 675465, width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
			{ videoId: 70111470, width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
			{ videoId: 70111470, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" },
			{ videoId: 654356453, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
			{ videoId: 654356453, width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }
		],
		bookmarks = [
			{ videoId: 65432445, time: 32432 },
			{ videoId: 675465, time: 3534543 },
			{ videoId: 70111470, time: 645243 },
			{ videoId: 654356453, time: 984934 }
		];

        return lists
            .map(
                list => ({
                    name: list.name,
                    videos: videos
                        .filter(video => video.listId === list.id)
                        .concatMap(video => 
                            Array.zip(
                                boxarts
                                    .filter(boxart => boxart.videoId === video.id)
                                    .reduce((ba1, ba2) => ba1.width * ba1.height > ba2.width * ba2.height ?  ba2 : ba1), 
                                bookmarks
                                    .filter(bookmark => bookmark.videoId === video.id),
                                (boxart, bookmark) => ({
                                    id: video.id,
                                    title: video.title,
                                    time: bookmark.time,
                                    boxart: boxart.url
                                })
                            )
                        )
                })
            ); // complete this expression
};
    log(26, deeperTrees());

    //27.
    var nasdaqPricesObservable = function(pricesNASDAQ, printRecord) {
        var microsoftPrices,
            now = new Date(),
            tenDaysAgo = new Date( now.getFullYear(), now.getMonth(), now.getDate() - 10);

        // use filter() to filter the trades for MSFT prices recorded any time after 10 days ago
        microsoftPrices =
            pricesNASDAQ.
                filter(function(priceRecord) {	 // finish this expression
                    return priceRecord.name === 'MSFT';
                });

        // Print the trades to the output console
        microsoftPrices.
            forEach(function(priceRecord) {
                printRecord(priceRecord);
            });
    };

    nasdaqPricesObservable(
        [{name: 'MSFT'}, {name: 'APPL'}, {name: 'MSFT'}],
        log);

    //28. 
    var classicObserver = function(button) {
        // the button click handler
        var handler = function(ev) {
            // Unsubscribe from the button event.
            button.removeEventListener("click", handler);

            alert("Button was clicked. Unsubscribing from event.");
        };

        // add the button click handler
        button.addEventListener("click", handler);
    }
		
    var button = document.getElementById("button1");
    classicObserver(button);

    //29.
    // https://github.com/ReactiveX/rxjs
    // https://unpkg.com/rxjs@rc/bundles/rxjs.umd.min.js
    var subscribingButtonClickEvent = function(button) {
        var buttonClicks = Observable.fromEvent(button, "click");

        // In the case of an Observable, forEach returns a subscription object.
        var subscription =
            buttonClicks.
                forEach(function(clickEvent) {
                    alert("Button was clicked. Stopping Traversal.");

                    // Stop traversing the button clicks
                    subscription.dispose();
                });
    };

    //30. 
    var observableClick = function(button) {
        var buttonClicks = Observable.fromEvent(button, "click");

        // Use take() to listen for only one button click
        // and unsubscribe.
        buttonClicks.
        take(1).
            // Insert take() call here
            forEach(function(clickEvent) {
                alert("Button was clicked once. Stopping Traversal.");
            });
    };

    //31.
    var takeUntilObservable = function(pricesNASDAQ, printRecord, stopButton) {
        var stopButtonClicks = Observable.fromEvent(stopButton, 'click'); // ----- To finish this expression, use Observable.fromEvent to convert the "click" event on the stop button to an Observable
            microsoftPrices =
                pricesNASDAQ.
                    filter(function(priceRecord) {
                        return priceRecord.name === "MSFT";
                    }).
        takeUntil(stopButtonClicks);
                    // ----- To finish this expression, use takeUntil to complete the sequence when stopButtonClicks fires.

        microsoftPrices.
            forEach(function(priceRecord) {
                printRecord(priceRecord);
            });
    };

//we can safely ignore the fololowing 2-3-4 examples for the presentation
    var observableDrags = function(){
        var drags = element.mouseDowns
            .map(mouseDown => 
                element.mouseMoves
                    .takeUntil(element.mouseUps))
            .concatAll();

        drags.forEach(mouseDrag => {
            log(mouseDrag);
        });
    };

    var handle = setTimeout(()=> log('hi'), 2000);
    clearTimeout(handle);

    var handler2 = () => console.log('hi');
    document.addEventListener('click', handler2);
    document.removeEventListener('click', handler2);

    var observer = {
        onNext(x) { log(x) },
        onError(e) { console.error(e) },
        onCompleted() { log('done') }
    };

    var timeout = function(time) {
        return {
            forEach: (observer) => {
                var handle = setTimeout(()=> {
                    observer.onNext(undefined);
                    observer.onCompleted();
                }, time);

                return {
                    dispose: () => {
                        clearTimeout(handle);
                    }
                };
            }
        };
    };
    
    var tmo1 = timeout(5000);  // timeout just creates an observable
    tmo1.forEach({
        onNext: (v) => log(tmo1, 'timeout'),
        onCompleted() { log('done') }
    });

    var fromEvent = function(dom, eventName) {
        return {
            forEach: (observer) => {
                var handle = (e)=> {
                    observer.onNext(e);
                };
                dom.addEventListener(eventName, handler);
                
                // subscription object
                return {
                    dispose: () => {
                        dom.removeEventListener(eventName, handler);
                    }
                };
            }
        };
    };

        var getElementDrags2 = elmt => {
            elmt.mouseDowns = Rx.Observable.fromEvent(elmt, "mousedown");
            elmt.mouseUps = Rx.Observable.fromEvent(elmt, "mouseup");
            elmt.mouseMoves = Rx.Observable.fromEvent(elmt, "mousemove");

            return elmt.mouseDowns.map(mouseDown => elmt.mouseMoves);
        };
        var image = document.getElementById("image1");
        //getElementDrags2(image).forEach({ onNext: e => log(e) }); // this still does not work

        // const source = Rx.Observable.interval(1000);
        // //sample last emitted value from source every 2s 
        // const example = source.sample(Rx.Observable.interval(2000));
        // //output: 2..4..6..8..
        // const subscribe = example.subscribe(val => console.log(val));
        // https://www.learnrxjs.io/operators/filtering/sample.html
        // http://reactivex.io/learnrx/
        // http://jsbin.com/kovevadewi/edit?html,js,console

        var textbox = document.getElementById('textbox');
        // textbox.addEventListener('keypress', (e)=> {
        //     log(e.keyCode);  // this is the classic mode
        // });

        var Observable = Rx.Observable;
        // var keypresses = Observable.fromEvent(textbox, 'keypress');
        // keypresses.forEach(e => log(e.keyCode));

        var searchWikipedia = function(term){
           // var url = 'http://en.wikipedia.org/w/api.php?action=opensearch&format=json&search' + encodeURIComponent(term) + 'callback=?';
            var url = 'https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=' + encodeURIComponent(term) + '&prop=extracts&exlimit=10&exintro&exsentences=2&format=json&callback=?';
            $.getJSON(url, (data) => log(data.query.pages));
        };
        searchWikipedia('Terminator');

        var jsonNetflix = function() {
            $.ajaxSetup({
                headers : {
                    "Access-Control-Allow-Credentials": true,
                    "Access-Control-Allow-Methods": "GET,HEAD,OPTIONS,POST,PUT",
                    "Access-Control-Allow-Headers": "Access-Control-Allow-Origin, Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers",
                    'Access-Control-Allow-Origin' : '*'
                }
            });
            $.getJSON(
                "http://api-global.netflix.com/queue",
                {
                    success: function(json) {
                        console.log(json);
                    },
                    error: function(ex) {
                        alert("There was an error.")
                    }
                });
        };
        //jsonNetflix();

        var getWikipediaSearchResults1 = function(term) {
            return {
                forEach: (observer) => {
                    var canceled = false;
                    var url = 'https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=' + encodeURIComponent(term) + '&prop=extracts&exlimit=10&exintro&exsentences=2&format=json&callback=?';
                    $.getJSON(url, (data) => {
                        if(!canceled)
                        {
                            observer.onNext(data.query.pages);
                            observer.onCompleted();
                        }
                    });

                    return {
                        dispose: function(){
                            canceled = true;
                        }
                    };
                }
            };
        };

        var getWikipediaSearchResults2 = function(term) {
            return Observable.create(function forEach(observer) {
                var canceled = false;
                var url = 'https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=' + encodeURIComponent(term) + '&prop=extracts&exlimit=10&exintro&exsentences=2&format=json&callback=?';
                $.getJSON(url, (data) => {
                    if(!canceled)
                    {
                        observer.next(data.query.pages);
                        observer.complete();
                    }
                });

                return function dispose(){
                    canceled = true;
                };
            });
        };

        getWikipediaSearchResults1('Terminator').forEach({
            onNext: (results) => {
                log('getWikipediaSearchResults1', results);
            },
            onCompleted: ()=> log('done')
        });
        getWikipediaSearchResults2('Terminator')
            .forEach(function(results) {
                log('getWikipediaSearchResults2', results);
            });

        var results = document.getElementById('results');
        var keypresses2 = Observable.fromEvent(textbox, 'keypress');
        
        // var searchResultSets = keypresses2
        //     .throttleTime(20)
        //     .map(key => getWikipediaSearchResults2(textbox.value))
        //     //.mergeAll()     //we get ALL exactly in the order they arrive => we don't want it!
        //     //.concat()       //
        //     .switchLatest();  //only listens to one (latest) inner observable at a time. usually in UI we use SwitchLatest
        //     searchResultSets.subscribe(function(resultSet){ // instead of forEach
        //         results.value = JSON.stringify(resultSet);
        //     });

// here we resume the presentation
// this is the classic Rx.Observable
            var clicks = Rx.Observable.fromEvent(document, 'click');
            var result = clicks.throttleTime(1000).take(5);
            result.subscribe(x => console.log(x));

// and this is our own observable
        var Observable1 = function(forEach){
            this._forEach = forEach;
        };

        Observable1.prototype = {
            forEach: function(onNext, onError, onCompleted){
                if(typeof onNext === "function"){
                    return this._forEach({
                        onNext: onNext,
                        onError: onError || function(){},
                        onCompleted: onCompleted || function(){}
                    });
                } else {
                    return this._forEach(onNext);
                }
            },
            map: function(projectionFunction){
                var context = this;
                return new Observable1(function forEach(observer){
                    return context.forEach(
                        x => observer.onNext(projectionFunction(x)),    // or function onNext()...
                        function onError(e) {  observer.onError(e); },
                        function onCompleted() { observer.onCompleted(); }
                    )
                });
            },
            filter: function(testFunction){
                var context = this;
                return new Observable1(function forEach(observer){
                    return context.forEach(
                        x => {
                            if(testFunction(x))
                            {
                                observer.onNext(x);
                            }
                        },    // or function onNext()...
                        function onError(e) {  observer.onError(e); },
                        function onCompleted() { observer.onCompleted(); }
                    )
                });
            },
            take: function(maxNum){
                var context = this;
                return new Observable1(function forEach(observer){
                    var subscription = context.forEach(
                        x => {
                            if(maxNum > 0)
                            {
                                observer.onNext(x);
                                maxNum -= 1;
                            } else {
                                subscription.dispose();
                                observer.onCompleted();
                            }
                        },    // or function onNext()...
                        function onError(e) {  observer.onError(e); },
                        function onCompleted() { observer.onCompleted(); }
                    );
                });
            }
        };

        Observable1.fromEvent = function(dom, eventName){
            return new Observable1(function forEachBlaBla(observer1){
                var handler = (e) => observer1.onNext(e);
                dom.addEventListener(eventName, handler);

                // subscription
                return {
                    dispose: () => {
                        dom.removeEventListener(eventName, handler);
                    }
                };
            });
        };
        var obs1 = new Observable1(function forEach(observer){

        });
        var clicks2 = Observable1.fromEvent(document, 'click');
        var subscription = clicks2.forEach((e)=>log("clicks2", e));
        setTimeout(() => subscription.dispose(), 8000);

        var buttonclicks = Observable1.fromEvent(button, "click")
            .filter(x => x.pageX < 425)
            .map(x => x.pageX + "px")
            .take(10);
        buttonclicks.forEach(x => log("button-click", x));


    </script>
</html>