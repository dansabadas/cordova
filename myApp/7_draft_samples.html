<document>
    <body>
        <button id="btn1">Hello</button>
        <script>
            var log = console.log;
            
            var ex3 = function() {
	var newReleases = [
		{
			"id": 70111470,
			"title": "Die Hard",
			"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [4.0],
			"bookmark": []
		},
		{
			"id": 654356453,
			"title": "Bad Boys",
			"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [5.0],
			"bookmark": [{ id: 432534, time: 65876586 }]
		},
		{
			"id": 65432445,
			"title": "The Chamber",
			"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [4.0],
			"bookmark": []
		},
		{
			"id": 675465,
			"title": "Fracture",
			"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [5.0],
			"bookmark": [{ id: 432534, time: 65876586 }]
		}
	],
	videoAndTitlePairs = [];

	// ------------ INSERT CODE HERE! -----------------------------------
	// Use forEach function to accumulate {id, title} pairs from each video.
	// Put the results into the videoAndTitlePairs array using the Array's
	// push() method. Example: videoAndTitlePairs.push(newItem);
	// ------------ INSERT CODE HERE! -----------------------------------
    newReleases.forEach(video => videoAndTitlePairs.push({id: video.id, title: video.title}));


	return videoAndTitlePairs;
}
		log(ex3());

        Array.prototype.map = function(projectionFunction) {
            var results = [];
            this.forEach(function(itemInArray) {

                // ------------ INSERT CODE HERE! ----------------------------
                // Apply the projectionFunction to each item in the array and add
                // each result to the results array.
                // Note: you can add items to an array with the push() method.
                // ------------ INSERT CODE HERE! ----------------------------
                results.push(projectionFunction(itemInArray));
            });

            return results;
        };

        log(JSON.stringify([1,2,3].map(function(x) { return x + 1; })) === '[2,3,4]');

        var projection2 = function() {
            var newReleases = [
                {
                    "id": 70111470,
                    "title": "Die Hard",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 654356453,
                    "title": "Bad Boys",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                },
                {
                    "id": 65432445,
                    "title": "The Chamber",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [4.0],
                    "bookmark": []
                },
                {
                    "id": 675465,
                    "title": "Fracture",
                    "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                    "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                    "rating": [5.0],
                    "bookmark": [{ id: 432534, time: 65876586 }]
                }
            ];

            // ------------ INSERT CODE HERE! -----------------------------------
            // Use map function to accumulate {id, title} pairs from each video.
            return newReleases.map(video => ({ id: video.id, title: video.title })); // finish this expression!
            // ------------ INSERT CODE HERE! -----------------------------------
        }

    log(projection2());

    Array.prototype.filter = function(predicateFunction) {
        var results = [];
        this.forEach(function(itemInArray) {
            // ------------ INSERT CODE HERE! ----------------------------
            // Apply the predicateFunction to each item in the array.
            // If the result is truthy, add the item to the results array.
            // Note: remember you can add items to the array using the array's
            // push() method.
            // ------------ INSERT CODE HERE! ----------------------------
            var isTrue = predicateFunction(itemInArray);
            if(isTrue){
                results.push(itemInArray);
            }
        });

        return results;
    };

    log(JSON.stringify([1,2,3].filter(function(x) { return x > 2})) === "[3]");

    var chaining = function() {
        var newReleases = [
            {
                "id": 70111470,
                "title": "Die Hard",
                "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 654356453,
                "title": "Bad Boys",
                "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            },
            {
                "id": 65432445,
                "title": "The Chamber",
                "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 4.0,
                "bookmark": []
            },
            {
                "id": 675465,
                "title": "Fracture",
                "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                "rating": 5.0,
                "bookmark": [{ id: 432534, time: 65876586 }]
            }
        ];

        // ------------ INSERT CODE HERE! -----------------------------------
        // Chain the filter and map functions to select the id of all videos
        // with a rating of 5.0.
        return newReleases
            .filter(video => video.rating === 5)
            .map(video => video.id) // Complete this expression
        // ------------ INSERT CODE HERE! -----------------------------------
    }

    log(chaining());
    Array.prototype.concatAll = function() {
            var results = [];
            this.forEach(function(subArray) {
                // ------------ INSERT CODE HERE! ----------------------------
                // Add all the items in each subArray to the results array.
                // ------------ INSERT CODE HERE! ----------------------------
                subArray.forEach((subArrayElement) => {
                    results.push(subArrayElement);
                });
            });

        return results;
    };

    log(JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]");
    try{
        [1,2,3].concatAll(); // throws an error because this is a one-dimensional array
    }
    catch(err){
        log(err);
    }
    var mapAndConcatAll =function() {
        var movieLists = [
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "Dramas",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
                            "uri": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];

        // ------------   INSERT CODE HERE!  -----------------------------------
        // Use map and concatAll to flatten the movieLists in a list of video ids.
        // ------------   INSERT CODE HERE!  -----------------------------------

        return movieLists
            .map(ml => ml.videos.map(video => video.id))
            .concatAll(); // Complete this expression!
    }

    log(11, mapAndConcatAll());

    var idTitleAndOneBoxArt = function() {
        var movieLists = [
                {
                    name: "Instant Queue",
                    videos : [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];


        // Use one or more map, concatAll, and filter calls to create an array with the following items
        // [
        //	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
        //	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
        //	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
        //	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

//this is not good enough!
        // return movieLists
        //     .map(ml => ml.videos)
        //     .concatAll()
        //     .map(video => ({ 
        //         id: video.id, 
        //         title: video.title, 
        //         boxart: 
        //             video.boxarts
        //                 .filter(ba => ba.height === 200 && ba.width === 150)
        //                 .map(boxart => boxart.url)
        //     }));
        return movieLists
            .map(ml => 
                ml.videos.map(video => 
                    video.boxarts
                        .filter(ba => ba.height === 200 && ba.width === 150)
                        .map(boxart => ({
                            id: video.id,
                            title: video.title,
                            boxart: boxart.url
                        }))))
            .concatAll()
            .concatAll();
             // Complete this expression!
    }

    log(12, idTitleAndOneBoxArt());

    Array.prototype.concatMap = function(projectionFunctionThatReturnsArray) {
	    return this
		    .map((item) => projectionFunctionThatReturnsArray(item))		
		    .concatAll();// apply the concatAll function to flatten the two-dimensional array
    };


	var spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ];
	// collect all the words for each number, in every language, in a single, flat list
	var allWords = [0,1,2].
		concatMap(function(index) {
			return spanishFrenchEnglishWords[index];
		});

	log(13, JSON.stringify(allWords) === '["cero","rien","zero","uno","un","one","dos","deux","two"]');
        
    var concatMap = function() {
        var movieLists = [
                {
                    name: "Instant Queue",
                    videos : [
                        {
                            "id": 70111470,
                            "title": "Die Hard",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 654356453,
                            "title": "Bad Boys",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                },
                {
                    name: "New Releases",
                    videos: [
                        {
                            "id": 65432445,
                            "title": "The Chamber",
                            "boxarts": [
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 4.0,
                            "bookmark": []
                        },
                        {
                            "id": 675465,
                            "title": "Fracture",
                            "boxarts": [
                                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                            ],
                            "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                            "rating": 5.0,
                            "bookmark": [{ id: 432534, time: 65876586 }]
                        }
                    ]
                }
            ];


        // Use one or more concatMap, map, and filter calls to create an array with the following items
        // [
        //	 {"id": 675465, "title": "Fracture", "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
        //	 {"id": 65432445, "title": "The Chamber", "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
        //	 {"id": 654356453, "title": "Bad Boys", "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
        //	 {"id": 70111470, "title": "Die Hard", "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        return movieLists
                .concatMap(ml => 
                    ml.videos.concatMap(video => 
                        video.boxarts
                            .filter(ba => ba.height === 200 && ba.width === 150)
                            .map(boxart => ({
                                id: video.id,
                                title: video.title,
                                boxart: boxart.url
                            })))); // Complete this expression!
    };
	log(14, concatMap());

    log([1,2,3].reduce((acc, curr)=> acc + curr));
    //log([].reduce((acc, curr)=> acc + curr))    // error!
    log([1, 2, 3].reduce(
        function (accumulatedValue, currentValue) { 
            return accumulatedValue + currentValue; 
        }, 
        10));
        log([1].reduce((acc, curr)=> acc + curr));

Array.prototype.reduce = function(combiner, initialValue) {
        var counter,
            accumulatedValue;

        // If the array is empty, do nothing
        if (this.length === 0) {
            return this;
        }

        // If the user didn't pass the initial value, use the first item as initial value.
        if (arguments.length === 1) {
            counter = 1;
            accumulatedValue = this[0];
        }
        else if (arguments.length === 2) {
            counter = 0;
            accumulatedValue = initialValue;
        }
        else {
            throw "Invalid arguments.";
        }

        // Loop through the array, feeding the current value and the result of
        // the previous computation back into the combiner function until
        // we've exhausted the entire array and are left with only one value.
        while(counter < this.length) {
            accumulatedValue = combiner(accumulatedValue, this[counter]);
            counter += 1;
        }

        return [accumulatedValue];
    };
    var reduceTheLargestRating = function() {
        var ratings = [2,3,1,4,5];

        // You should return an array containing only the largest rating. Remember that reduce always
        // returns an array with one item.
        return ratings.
            reduce((x,y) => x - y > 0 ? x : y);   // Complete this expression
    };
	log(17, reduceTheLargestRating());

     // 18.
     var largestBoxartUrlWithMapReduce = function() {
        var boxarts = [
                { width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                { width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
                { width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
                { width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
            ];

        // You should return an array containing only the URL of the largest box art. Remember that reduce always
        // returns an array with one item.
        return boxarts
            .reduce((x, y) => x.width * x.height > y.width * y.height ?  x : y)
            .map(x => x.url);   // Complete this expression
    };

    log(18, largestBoxartUrlWithMapReduce());

        var accumulatedMap = function() {
        var videos = [
            {
                "id": 65432445,
                "title": "The Chamber"
            },
            {
                "id": 675465,
                "title": "Fracture"
            },
            {
                "id": 70111470,
                "title": "Die Hard"
            },
            {
                "id": 654356453,
                "title": "Bad Boys"
            }
        ];

        // Expecting this output...
        // [
        //	 {
        //		 "65432445": "The Chamber",
        //		 "675465": "Fracture",
        //		 "70111470": "Die Hard",
        //		 "654356453": "Bad Boys"
        //	 }
        // ]
        return videos.
            reduce((accumulatedMap, video) => {
                var obj = {};

                // ----- INSERT CODE TO ADD THE VIDEO TITLE TO THE ----
                // ----- NEW MAP USING THE VIDEO ID AS THE KEY	 ----

                // Object.assign() takes all of the enumerable properties from
                // the object listed in its second argument (obj) and assigns them
                // to the object listed in its first argument (accumulatedMap).
                obj[video.id] = video.title;
                return Object.assign(accumulatedMap, obj);  // .assign is ES6 specific! use Object.create(accumulatedMap) (which creates a clone approach instead, if no ES6 support
            },
            // Use an empty map as the initial value instead of the first item in
            // the list.
          {});

      // !! we don't use this example commented below because we mutate the accumulatedMap and we do not want to do that!!!!!
        //return videos.
        //  reduce((accumulatedMap, video) => {
        //    accumulatedMap[video.id] = video.title;
        //    return accumulatedMap;  
        //  },
        //  {});
    };
    log(19, accumulatedMap());

    var concatMapReduceSmallestBoxart = function() {
        var movieLists = [
            {
                name: "New Releases",
                videos: [
                    {
                        "id": 70111470,
                        "title": "Die Hard",
                        "boxarts": [
                            { width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                        "bookmark": []
                    },
                    {
                        "id": 654356453,
                        "title": "Bad Boys",
                        "boxarts": [
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
                            { width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                        "bookmark": [{ id:432534, time:65876586 }]
                    }
                ]
            },
            {
                name: "Thrillers",
                videos: [
                    {
                        "id": 65432445,
                        "title": "The Chamber",
                        "boxarts": [
                            { width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 4.0,
                        "bookmark": []
                    },
                    {
                        "id": 675465,
                        "title": "Fracture",
                        "boxarts": [
                            { width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
                            { width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
                            { width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
                        ],
                        "url": "http://api.netflix.com/catalog/titles/movies/70111470",
                        "rating": 5.0,
                        "bookmark": [{ id:432534, time:65876586 }]
                    }
                ]
            }
        ];


        // Use one or more concatMap, map, and reduce calls to create an array with the following items (order doesn't matter)
        // [
        //	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
        //	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
        //	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" },
        //	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
        // ];

        return movieLists.
            concatMap(movieList =>
                movieList.videos
                    .concatMap(video => 
                        video.boxarts
                            .reduce((ba1, ba2) => ba1.width * ba1.height > ba2.width * ba2.height ?  ba2 : ba1)
                            .map(ba => ({id: video.id, title: video.title, boxart: ba.url}))
                    )
            );
    };
		log(20, concatMapReduceSmallestBoxart());
        </script>
    </body>
</document>
